# CortexWatcher

üëâ –ê–Ω–≥–ª–æ–º–æ–≤–Ω–∞ –≤–µ—Ä—Å—ñ—è: [README.en.md](README.en.md)

CortexWatcher ‚Äî —Ü–µ —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç —Ç–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –∑–±–æ—Ä—É, –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ –ª–æ–≥—ñ–≤ —ñ–∑ —Ä—ñ–∑–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª. –†—ñ—à–µ–Ω–Ω—è –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–µ –Ω–∞ –∫–æ–º–∞–Ω–¥–∏ –±–µ–∑–ø–µ–∫–∏ —Ç–∞ SRE, —è–∫—ñ —Ö–æ—á—É—Ç—å —à–≤–∏–¥–∫–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ –ø–æ–¥—ñ—ó –∑ Telegram-–≥—Ä—É–ø, Wazuh, Graylog —Ç–∞ syslog, –æ—Ç—Ä–∏–º—É—é—á–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –∞–ª–µ—Ä—Ç–∏ —Ç–∞ –º–µ—Ç—Ä–∏–∫–∏ –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ.

## –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ
- –ü—Ä–∏–π–æ–º –ª–æ–≥—ñ–≤ —ñ–∑ Telegram (—Ç–µ–∫—Å—Ç —Ç–∞ —Ñ–∞–π–ª–∏, –≤–∫–ª—é—á–Ω–æ –∑ .gz/.zip) —Ç–∞ HTTP API (GELF, Wazuh, JSON/NDJSON, Suricata EVE).
- –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —É PostgreSQL (–∞–±–æ ClickHouse –ø—Ä–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—é).
- –ü—Ä–∞–≤–∏–ª–∞ –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø–æ–¥—ñ–π —Ç–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–Ω—ñ –∞–ª–µ—Ä—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ YAML-—Ñ–∞–π–ª—ñ–≤.
- –í–∏—è–≤–ª–µ–Ω–Ω—è –∞–Ω–æ–º–∞–ª—ñ–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–≤–∑–Ω–∏—Ö –º–µ—Ç—Ä–∏–∫ (z-score, –º–µ–¥—ñ–∞–Ω–∞).
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Redis + RQ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –∑–∞–¥–∞—á.
- FastAPI –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —ñ–∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ –ø–æ –ª–æ–≥–∞–º, –∞–ª–µ—Ä—Ç–∞–º —Ç–∞ —Å—Ç–∞–Ω—É —Å–µ—Ä–≤—ñ—Å—ñ–≤.
- –ú–µ—Ç—Ä–∏–∫–∏ Prometheus (/metrics) –¥–ª—è API —Ç–∞ –∞–Ω–∞–ª—ñ–∑–∞—Ç–æ—Ä–∞.
- –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤ JSON-—Ñ–æ—Ä–º–∞—Ç—ñ.
- –°—Ç–∞—Ç—É—Å–Ω—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ `/healthz` —Ç–∞ `/status` –¥–ª—è —à–≤–∏–¥–∫–æ—ó –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–µ—Ä–≤—ñ—Å—ñ–≤.

## –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç (docker-compose)
1. –°–∫–æ–ø—ñ—é–π—Ç–µ `.env.example` —É `.env` —Ç–∞ –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–æ–≤ º—è–∑–∫–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ:
   ```bash
   cp .env.example .env
   ```
2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É:
   ```bash
   docker compose up --build
   ```
3. –ü—ñ—Å–ª—è —Å—Ç–∞—Ä—Ç—É:
   - FastAPI –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞ `http://localhost:8080` (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è `/docs`).
   - Prometheus –º–µ—Ç—Ä–∏–∫–∏: `http://localhost:8080/metrics`.
   - –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –æ—á—ñ–∫—É—î –Ω–∞ –∫–æ–º–∞–Ω–¥–∏ —É whitelisted –≥—Ä—É–ø–∞—Ö.

## –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞
- Python 3.11 (—Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `pyenv` –∞–±–æ `asdf`).
- –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —è–∫ —É `Makefile setup`.
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `make format` –ø–µ—Ä–µ–¥ –∫–æ–º—ñ—Ç–æ–º.
- –¢–µ—Å—Ç–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–æ—é `make test`.
- –î–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `make ci`, —è–∫–∏–π –∑–∞–ø—É—Å–∫–∞—î –ª—ñ–Ω—Ç–µ—Ä–∏, mypy, pytest —ñ–∑ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ø–æ–∫—Ä–∏—Ç—Ç—è —Ç–∞ –∞—É–¥–∏—Ç –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π.

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- `GET /healthz` ‚Äî –ª–µ–≥–∫–∏–π ping, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î `{"status": "ok"}` —Ç–∞ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è liveness-–ø—Ä–æ–± —É Kubernetes –∞–±–æ docker-compose.
- `GET /status` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∏–π –∑—Ä—ñ–∑ —Å—Ç–∞–Ω—É –ë–î, Redis, —á–µ—Ä–≥–∏ RQ, –∫–µ—à—É –º–µ—Ç—Ä–∏–∫, ClickHouse —ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –±–µ–∫–µ–Ω–¥–∞ —Å—Ö–æ–≤–∏—â–∞. –ó–Ω–∞—á–µ–Ω–Ω—è –º–µ—Ç—Ä–∏–∫ –∑–±–∏—Ä–∞—é—Ç—å—Å—è –∑ Redis —Ç–∞ –≤–∫–ª—é—á–∞—é—Ç—å `events_total`, `alerts_total`, —Å–µ—Ä–µ–¥–Ω—ñ/–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ñ –∑–∞—Ç—Ä–∏–º–∫–∏ —ñ–Ω–∂–µ—Å—Ç—É, –∞ —Ç–∞–∫–æ–∂ –æ—Ü—ñ–Ω–∫—É —à–≤–∏–¥–∫–æ—Å—Ç—ñ –ø–æ–¥—ñ–π —ñ –∞–ª–µ—Ä—Ç—ñ–≤ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—é —Ö–≤–∏–ª–∏–Ω—É.
- –ü–æ–ª–µ `status` —É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ `/status` –ø—Ä–∏–π–º–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è `ok`, `degraded` –∞–±–æ `error` –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –Ω–∞–π–≥—ñ—Ä—à–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–æ—Å—Ç—ñ –∞–ª–µ—Ä—Ç–∏ –±–µ–∑ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –ø—Ä–∞–≤–∏–ª.
- –ï–Ω–¥–ø–æ—ñ–Ω—Ç `/status` –≤—ñ–¥–∫—Ä–∏—Ç–∏–π –ª–∏—à–µ –¥–ª—è —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤ —ñ –Ω–µ —Ä–æ–∑–∫—Ä–∏–≤–∞—î –≤–º—ñ—Å—Ç—É –ª–æ–≥—ñ–≤ —á–∏ –∞–ª–µ—Ä—Ç—ñ–≤.

## –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
–û—Å–Ω–æ–≤–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:
- `TG_BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞.
- `ALLOWED_CHAT_IDS` ‚Äî —Å–ø–∏—Å–æ–∫ –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö chat_id (—á–µ—Ä–µ–∑ –∫–æ–º—É).
- `DATABASE_URL` ‚Äî URL –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ PostgreSQL.
- `REDIS_URL` ‚Äî URL Redis –¥–ª—è —á–µ—Ä–≥–∏ RQ.
- `CLICKHOUSE_URL` ‚Äî –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ ClickHouse.
- `INGEST_MAX_FILE_MB` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –≤—Ö—ñ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª—É.
- `ALERT_MIN_LEVEL` ‚Äî –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –∞–ª–µ—Ä—Ç—É.
- `ANOMALY_WINDOW_MIN` ‚Äî —Ä–æ–∑–º—ñ—Ä –≤—ñ–∫–Ω–∞ –¥–ª—è –∞–Ω–æ–º–∞–ª—ñ–π (—É —Ö–≤–∏–ª–∏–Ω–∞—Ö).
- `API_AUTH_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø—É –¥–æ –∑–∞—Ö–∏—â–µ–Ω–∏—Ö –µ–Ω–¥–ø–æ—ñ–Ω—Ç—ñ–≤ API.

## –¢–∏–ø–æ–≤—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó
1. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ Telegram-–≥—Ä—É–ø:** –±–æ—Ç —á–∏—Ç–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ whitelisted –≥—Ä—É–ø, —Ñ–∞–π–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑–ø–∞–∫–æ–≤—É—é—Ç—å—Å—è —Ç–∞ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –≤ —á–µ—Ä–≥—É –Ω–∞ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—é.
2. **–ü–∞—Ä—Å–∏–Ω–≥ syslog/JSON/GELF/Suricata:** API –ø—Ä–∏–π–º–∞—î –ø–∞–∫–µ—Ç–∏ –ª–æ–≥—ñ–≤, –∑–±–µ—Ä—ñ–≥–∞—î —ó—Ö —É —Å–∏—Ä–æ–º—É —Ç–∞ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ, –¥–æ—Å—Ç—É–ø–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏ —É `/logs`.
3. **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è Wazuh:** –æ–∫—Ä–µ–º–∏–π endpoint `/ingest/wazuh` –ø—Ä–∏–π–º–∞—î JSON-–∞–ª–µ—Ä—Ç–∏, —Å—Ç–≤–æ—Ä—é—î –∑–∞–ø–∏—Å–∏ —É —Ç–∞–±–ª–∏—Ü—ñ `alerts` —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É Telegram.
4. **–ü–µ—Ä–µ–≥–ª—è–¥ –∞–ª–µ—Ä—Ç—ñ–≤:** —á–µ—Ä–µ–∑ `/alerts` –º–æ–∂–Ω–∞ –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è —Ç–∞ —ó—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç.

## –û–±–º–µ–∂–µ–Ω–Ω—è —Ç–∞ –±–µ–∑–ø–µ–∫–∞
- –£—Å—ñ —Å–µ–∫—Ä–µ—Ç–∏ –∑–∞–¥–∞—é—Ç—å—Å—è –ª–∏—à–µ —á–µ—Ä–µ–∑ `.env` –∞–±–æ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞.
- –Ñ whitelist chat_id –¥–ª—è Telegram, –±–∞–∑–æ–≤—ñ rate-limit –º–µ—Ö–∞–Ω—ñ–∑–º–∏.
- –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Ä–æ–∑–º—ñ—Ä—É —Ñ–∞–π–ª—ñ–≤ —Ç–∞ –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ zip-bomb.
- –ú–µ—Ö–∞–Ω—ñ–∑–º–∏ –∞–Ω–æ–º–∞–ª—ñ–π –±–∞–∑–æ–≤—ñ –π –Ω–µ –∑–∞–º—ñ–Ω—é—é—Ç—å –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω—ñ SIEM-—Ä—ñ—à–µ–Ω–Ω—è.

## –°—Ç–∞—Ä—Ç–æ–≤—ñ –∑–∞–¥–∞—á—ñ (Tickets)
- [ ] –Ü–º–ø–æ—Ä—Ç TG-–≤–∫–ª–∞–¥–µ–Ω—å ‚Üí ingestor ‚Üí –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è ‚Üí –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.
- [ ] –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ 3 –ø—Ä–∏–∫–ª–∞–¥–∏ –ø—Ä–∞–≤–∏–ª (SSH brute, NGINX 5xx burst, Wazuh high-level).
- [ ] –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è –∞–ª–µ—Ä—Ç—ñ–≤ —É TG + throttle.
- [x] `/status` –≤—ñ–¥–¥–∞—î –æ—Å–Ω–æ–≤–Ω—ñ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏ –∑ Redis/DB.
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –∑–∞–ø—É—Å–∫—É (docker-compose) —Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–µ–≤—É.

